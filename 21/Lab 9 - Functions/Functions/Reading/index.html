<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-Lab 9 - Functions/Functions/Reading/README">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.1.0">
<title data-rh="true">Functions | Hardware Software Interface</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="http://localhost//hardware-software-interface/21/Lab 9 - Functions/Functions/Reading/"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Functions | Hardware Software Interface"><meta data-rh="true" name="description" content="In this lab, we&#x27;ll discuss how function calls are performed. We&#x27;ll see how we can use the call and ret instructions to make function calls and how we use the stack to pass function parameters."><meta data-rh="true" property="og:description" content="In this lab, we&#x27;ll discuss how function calls are performed. We&#x27;ll see how we can use the call and ret instructions to make function calls and how we use the stack to pass function parameters."><link data-rh="true" rel="canonical" href="http://localhost//hardware-software-interface/21/Lab 9 - Functions/Functions/Reading/"><link data-rh="true" rel="alternate" href="http://localhost//hardware-software-interface/21/Lab 9 - Functions/Functions/Reading/" hreflang="en"><link data-rh="true" rel="alternate" href="http://localhost//hardware-software-interface/21/Lab 9 - Functions/Functions/Reading/" hreflang="x-default"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css" integrity="sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM" crossorigin="anonymous"><link rel="stylesheet" href="/hardware-software-interface/21/assets/css/styles.49519274.css">
<link rel="preload" href="/hardware-software-interface/21/assets/js/runtime~main.e33335a0.js" as="script">
<link rel="preload" href="/hardware-software-interface/21/assets/js/main.8aa22bd5.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="theme.common.skipToMainContent"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/hardware-software-interface/21/"><div class="navbar__logo"><img src="/hardware-software-interface/21/img/logo.svg" alt="Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/hardware-software-interface/21/img/logo.svg" alt="Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Hardware Software Interface</b></a><a class="navbar__item navbar__link" href="/hardware-software-interface/21/Lab 1 - Number Representation">Lab 1 - Number Representation</a><a class="navbar__item navbar__link" href="/hardware-software-interface/21/Lab 2 - Memory Operations. Introduction to GDB">Lab 2 - Memory Operations. Introduction to GDB</a><a class="navbar__item navbar__link" href="/hardware-software-interface/21/Lab 4 - Toolchain. GOTO">Lab 4 - Toolchain. GOTO</a><a class="navbar__item navbar__link" href="/hardware-software-interface/21/Lab 5 - Introduction to Assembly Language">Lab 5 - Introduction to Assembly Language</a><a class="navbar__item navbar__link" href="/hardware-software-interface/21/Lab 6 - Registers and Memory Addressing">Lab 6 - Registers and Memory Addressing</a><a class="navbar__item navbar__link" href="/hardware-software-interface/21/Lab 7 - Structures, vectors and strings">Lab 7 - Structures, vectors and strings</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/hardware-software-interface/21/Lab 9 - Functions">Lab 9 - Functions</a></div><div class="navbar__items navbar__items--right"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/hardware-software-interface/21/">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/hardware-software-interface/21/Lab 1 - Number Representation/">Lab 1 - Number Representation</a><button aria-label="Toggle the collapsible sidebar category &#x27;Lab 1 - Number Representation&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/hardware-software-interface/21/Lab 2 - Memory Operations. Introduction to GDB/">Lab 2 - Memory Operations. Introduction to GDB</a><button aria-label="Toggle the collapsible sidebar category &#x27;Lab 2 - Memory Operations. Introduction to GDB&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/hardware-software-interface/21/Lab 4 - Toolchain. GOTO/">Lab 4 - Toolchain. GOTO</a><button aria-label="Toggle the collapsible sidebar category &#x27;Lab 4 - Toolchain. GOTO&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/hardware-software-interface/21/Lab 5 - Introduction to Assembly Language/">Lab 5 - Introduction to Assembly Language</a><button aria-label="Toggle the collapsible sidebar category &#x27;Lab 5 - Introduction to Assembly Language&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/hardware-software-interface/21/Lab 6 - Registers and Memory Addressing/">Lab 6 - Registers and Memory Addressing</a><button aria-label="Toggle the collapsible sidebar category &#x27;Lab 6 - Registers and Memory Addressing&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/hardware-software-interface/21/Lab 7 - Structures, vectors and strings/">Lab 7 - Structures, vectors and strings</a><button aria-label="Toggle the collapsible sidebar category &#x27;Lab 7 - Structures, vectors and strings&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/hardware-software-interface/21/Lab 9 - Functions/">Lab 9 - Functions</a><button aria-label="Toggle the collapsible sidebar category &#x27;Lab 9 - Functions&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" tabindex="0" href="/hardware-software-interface/21/Lab 9 - Functions/Functions/">Functions</a><button aria-label="Toggle the collapsible sidebar category &#x27;Functions&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/hardware-software-interface/21/Lab 9 - Functions/Functions/Reading/">Reading</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/hardware-software-interface/21/Lab 9 - Functions/Functions/Guides/">Guides</a><button aria-label="Toggle the collapsible sidebar category &#x27;Guides&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/hardware-software-interface/21/Lab 9 - Functions/Functions/Drills/">Drills</a><button aria-label="Toggle the collapsible sidebar category &#x27;Drills&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></li></ul></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/hardware-software-interface/21/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/hardware-software-interface/21/Lab 9 - Functions/"><span itemprop="name">Lab 9 - Functions</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/hardware-software-interface/21/Lab 9 - Functions/Functions/"><span itemprop="name">Functions</span></a><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Reading</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Functions</h1><p>In this lab, we&#x27;ll discuss how function calls are performed. We&#x27;ll see how we can use the <code>call</code> and <code>ret</code> instructions to make function calls and how we use the stack to pass function parameters.</p><p>The lab follows a &quot;learn by doing&quot; format, with practical parts alternating between tutorial sections, which guide you step by step, and exercises to be solved.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="passing-parameters">Passing Parameters<a class="hash-link" href="#passing-parameters" title="Direct link to heading">​</a></h2><p>When it comes to calling a function with parameters, there are two major options for placing them:</p><ol><li><p><strong>Register Passing</strong> - this method intuitively involves passing parameters through registers.</p><p><strong>Advantages</strong></p><ul><li>It is very easy to use when the number of parameters is small.</li><li>It is very fast since parameters are immediately accessible from registers.</li></ul><p><strong>Disadvantages</strong></p><ul><li>Because there is a limited number of registers, the number of parameters for a function becomes limited.</li><li>It&#x27;s very likely that some registers are used inside the called function, and it becomes necessary to temporarily save registers on the stack before the function call. Thus, the second advantage listed disappears because accessing the stack involves working with memory, meaning increased latency.</li></ul></li><li><p><strong>Stack Passing</strong> - this method involves pushing all parameters onto the stack.</p><p><strong>Advantages</strong></p><ul><li>A large number of parameters can be passed.</li></ul><p><strong>Disadvantages</strong></p><ul><li>It&#x27;s slow because it involves memory access.</li><li>More complicated in terms of parameter access.</li></ul></li></ol><blockquote><p><strong>NOTE:</strong> For <strong>32-bit</strong> architectures, the stack passing method is used, while for <strong>64-bit</strong> architectures, the register passing method is used. We will use the convention for 32-bit architecture.</p></blockquote><h2 class="anchor anchorWithStickyNavbar_LWe7" id="function-call">Function Call<a class="hash-link" href="#function-call" title="Direct link to heading">​</a></h2><p>When we call a function, the steps are as follows:</p><ul><li>We put the arguments on the stack, pushing them in the reverse order in which they are sent as function arguments.</li><li>We call <code>call</code>.</li><li>We restore the stack at the end of the call.</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="stack-operation">Stack Operation<a class="hash-link" href="#stack-operation" title="Direct link to heading">​</a></h3><p>As we know, stack operations fall into two types:</p><ul><li><code>push val</code> where the value <code>val</code> is placed on the stack</li><li><code>pop reg/mem</code> where what is on the top of the stack is placed into a register or memory area</li></ul><p>When we <code>push</code>, we say that the stack <strong>grows</strong> (elements are added). For reasons that will be better explained later, the stack pointer (indicated by the <code>esp</code> register in 32-bit mode) decreases in value when the stack grows (on <code>push</code>). However, this contradiction in naming comes from the fact that the stack is typically represented vertically, with smaller values at the top and larger values at the bottom.</p><p>Similarly, when we <code>pop</code>, we say that the stack <strong>shrinks</strong> (elements are removed). Now the stack pointer (indicated by the <code>esp</code> register in 32-bit mode) increases in value.</p><p>A summary of this is explained very well <a href="https://en.wikibooks.org/wiki/X86_Disassembly/The_Stack" target="_blank" rel="noopener noreferrer">here</a>.</p><p>For example, if we have the function <code>foo</code> with the following signature (in C language):</p><div class="language-C codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-C codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">int foo(int a, int b, int c);</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The call to this function will look like this:</p><div class="language-Assembly codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-Assembly codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mov ecx, [c]     ; take the value of parameter c from a memory location</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mov ebx, [b]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mov eax, [a]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">push ecx         ; put parameters in reverse order, starting with c</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">push ebx         ; then b</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">push eax         ; then a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">call foo         ; call the function</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">add esp, 12      ; restore the stack</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="caller-and-callee">Caller and Callee<a class="hash-link" href="#caller-and-callee" title="Direct link to heading">​</a></h2><p>When we call a function, we say that the calling function (the context that calls) is the <strong>caller</strong>, while the called function is the <strong>callee</strong>. In the previous paragraph, we discussed how things look at the caller level (how we build the stack).</p><p>Now let&#x27;s see what happens at the callee level. Until the <code>call</code> instruction, the stack contains the function&#x27;s parameters. The <code>call</code> can be roughly equated to the following sequence:</p><div class="language-Assembly codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-Assembly codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">push eip</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">jmp function_name</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>That is, even the <code>call</code> uses the stack and saves the address of the next instruction, the one after the <code>call</code>, also known as the <strong>return address</strong>. This is necessary for the callee to know where to return to in the caller.</p><p>In the callee, at its beginning (called preamble), the frame pointer is saved (in the i386 architecture, this is the <code>ebp</code> register), with the frame pointer then referring to the current function stack frame. This is crucial for accessing parameters and local variables via an offset from the frame pointer.</p><p>Although not mandatory, saving the frame pointer helps in debugging and is used in most cases. For these reasons, any function call will generally have a preamble:</p><div class="language-Assembly codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-Assembly codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">push ebp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mov ebp, esp</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>These modifications take place in the callee. Therefore, it is the responsibility of the callee to restore the stack to its old value. Hence, it is customary to have an epilogue that restores the stack to its initial state; this epilogue is:</p><div class="language-Assembly codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-Assembly codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">leave</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>After this instruction, the stack is as it was at the beginning of the function (immediately after the call).</p><p>To conclude the function, it is necessary for the execution to return and continue from the instruction following the <code>call</code> that started the function. This involves influencing the <code>eip</code> register and putting back the value that was saved on the stack initially by the <code>call</code> instruction. This is achieved using the instruction:</p><div class="language-Assembly codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-Assembly codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ret</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>which is roughly equivalent to the instruction:</p><div class="language-Assembly codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-Assembly codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">pop eip</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>For example, the definition and body of the function foo, which calculates the sum of 3 numbers, would look like this:</p><div class="language-Assembly codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-Assembly codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">foo:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    push ebp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mov ebp, esp</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mov eax, [ebp + 8]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mov ebx, [ebp + 12]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mov ecx, [ebp + 16]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    add eax, ebx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    add eax, ecx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    leave</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ret</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="remarks">Remarks:<a class="hash-link" href="#remarks" title="Direct link to heading">​</a></h3><ol><li><p>A function is defined by a label.</p></li><li><p>After the function&#x27;s preamble, the stack looks as follows:</p><p><img loading="lazy" alt="stack.svg" src="/hardware-software-interface/21/assets/images/stack-7e53a701b7907c4331d4dfc24028236a.svg" class="img_ev3q"></p></li><li><p>Note that during the execution of the function, what does not change is the position of the frame pointer. This is the reason for its name: it points to the current function&#x27;s frame. Therefore, it is common to access a function&#x27;s parameters through the frame pointer. Assuming a 32-bit system and processor word-sized parameters (32 bits, 4 bytes), we will have:</p><ul><li>the first argument is found at address <code>ebp+8</code></li><li>the second argument is found at address <code>ebp+12</code></li><li>the third argument is found at address <code>ebp+16</code></li><li>etc.</li></ul><p>This is why, to get the parameters of the foo function in the eax, ebx, ecx registers, we use the constructions:</p></li></ol><div class="language-Assembly codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-Assembly codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">   mov eax, dword [ebp+8]   ; first argument in eax</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   mov ebx, dword [ebp+12]  ; second argument in ebx</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   mov ecx, dword [ebp+16]  ; third argument in ecx</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="4"><li><p>The return value of a function is placed in registers (generally in eax).</p><ul><li><p>If the return value is <strong>8 bits</strong>, the function&#x27;s result is placed in <code>al</code>.</p></li><li><p>If the return value is <strong>16 bits</strong>, the function&#x27;s result is placed in <code>ax</code>.</p></li><li><p>If the return value is <strong>32 bits</strong>, the function&#x27;s result is placed in <code>eax</code>.</p></li><li><p>If the return value is <strong>64 bits</strong>, the result is placed in the <code>edx</code> and <code>eax</code> registers. The most significant 32 bits are placed in <code>edx</code>, and the rest in the <code>eax</code> register.</p><p><em>Additionally, in some cases, a memory address can be returned to the stack/heap (eg. malloc), or other memory areas, which refer to the desired object after the function call.</em></p></li></ul></li><li><p>A function uses the same hardware registers; therefore, when exiting the function, the values of the registers are no longer the same. To avoid this situation, some/all registers can be saved on the stack.</p></li></ol><blockquote><p><strong>NOTE:</strong>  Since assembly languages offer more opportunities, there is a need for calling conventions in x86. The difference between them may consist of the parameter order, how the parameters are passed to the function, which registers need to be preserved by the callee or whether the caller or callee handles stack preparation. More details can be found <a href="https://en.wikipedia.org/wiki/X86_calling_conventions" target="_blank" rel="noopener noreferrer">here</a> or <a href="https://levelup.gitconnected.com/x86-calling-conventions-a34812afe097" target="_blank" rel="noopener noreferrer">here</a> if Wikipedia is too mainstream for you.
For us, the registers <code>eax</code>, <code>ecx</code>, <code>edx</code> are considered <strong>clobbered</strong> (or volatile), and the calee can do whatever it wants to them. On the other hand, the calee has to ensure that <code>ebx</code> exits the function with the same value it has entered with.</p></blockquote></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/hardware-software-interface/21/Lab 9 - Functions/Functions/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Functions</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/hardware-software-interface/21/Lab 9 - Functions/Functions/Guides/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Guides</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#passing-parameters" class="table-of-contents__link toc-highlight">Passing Parameters</a></li><li><a href="#function-call" class="table-of-contents__link toc-highlight">Function Call</a><ul><li><a href="#stack-operation" class="table-of-contents__link toc-highlight">Stack Operation</a></li></ul></li><li><a href="#caller-and-callee" class="table-of-contents__link toc-highlight">Caller and Callee</a><ul><li><a href="#remarks" class="table-of-contents__link toc-highlight">Remarks:</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://curs.upb.ro" target="_blank" rel="noopener noreferrer" class="footer__link-item">Main site<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://ocw.cs.pub.ro/courses/pclp2" target="_blank" rel="noopener noreferrer" class="footer__link-item">OCW<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.facebook.com/10c1a" target="_blank" rel="noopener noreferrer" class="footer__link-item">Facebook<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 OpenEdu Team</div></div></div></footer></div>
<script src="/hardware-software-interface/21/assets/js/runtime~main.e33335a0.js"></script>
<script src="/hardware-software-interface/21/assets/js/main.8aa22bd5.js"></script>
</body>
</html>